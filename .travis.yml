language: java
jdk:
  - openjdk11
services:
  - docker

before_install:
  - pushd LibLaserCut && mvn install && popd
  # make sure we install legacy deps
  - mvn initialize

script: 
  - "./test.sh"
  - "mvn test"
  - mkdir /tmp/out
  - ls
  - echo current dir `pwd`
  - docker run -v /tmp/out:/app/output -v /home/travis/build/t-oster/VisiCut/:/app/build/VisiCut --user $UID -e VISICUT_UPDATE=false registry.gitlab.com/t-oster/visicutbuildservice
  - echo "Created out files:"
  - ls /tmp/out
  - ls /tmp/out/*

deploy:
  provider: releases
  api_key: "GITHUB OAUTH TOKEN"
  file: "/tmp/out/**/*"
  skip_cleanup: true
  on:
    tags: true
